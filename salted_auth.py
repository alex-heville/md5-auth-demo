import hashlib\nimport os\nimport secrets\n\nCREDENTIALS_FILE = \"credentials_salted.txt\"\nSALT_LENGTH = 16  # bytes\n\ndef register_user(username, password):\n    \"\"\"Register a user with username and password using salted MD5.\n    \n    Generates a random salt, hashes salt + password, and stores\n    username:salt:hash in credentials_salted.txt.\n    \"\"\"\n    # Generate cryptographically secure random salt\n    salt = secrets.token_bytes(SALT_LENGTH)\n    salt_hex = salt.hex()\n    \n    # Hash salt + password\n    hash_obj = hashlib.md5(salt + password.encode('utf-8'))\n    password_hash = hash_obj.hexdigest()\n    \n    # Write or append to credentials file\n    with open(CREDENTIALS_FILE, 'a') as f:\n        f.write(f\"{username}:{salt_hex}:{password_hash}\\n\")\n    \n    print(f\"User '{username}' registered successfully with salt.\")\n\n\ndef login_user(username, password):\n    \"\"\"Attempt to login a user using salted hashes.\n    \n    Reads the salt for the given user, hashes salt + password,\n    and compares with stored hash.\n    Returns True if credentials match, False otherwise.\n    \"\"\"\n    if not os.path.exists(CREDENTIALS_FILE):\n        print(\"No credentials file found.\")\n        return False\n    \n    # Look for username in credentials file\n    with open(CREDENTIALS_FILE, 'r') as f:\n        for line in f:\n            line = line.strip()\n            if not line:\n                continue\n            parts = line.split(':', 2)\n            if len(parts) != 3:\n                continue  # malformed line\n            stored_username, stored_salt_hex, stored_hash = parts\n            if stored_username == username:\n                # Convert hex salt back to bytes\n                salt = bytes.fromhex(stored_salt_hex)\n                # Hash the provided password with the stored salt\n                hash_obj = hashlib.md5(salt + password.encode('utf-8'))\n                password_hash = hash_obj.hexdigest()\n                if stored_hash == password_hash:\n                    print(f\"Login successful for user '{username}'.\")\n                    return True\n                else:\n                    print(f\"Login failed for user '{username}' (incorrect password).\")\n                    return False\n    \n    print(f\"User '{username}' not found.\")\n    return False\n\n\nif __name__ == \"__main__\":\n    # Example usage\n    register_user(\"alice\", \"password123\")\n    register_user(\"bob\", \"qwerty\")\n    \n    login_user(\"alice\", \"password123\")   # Should succeed\n    login_user(\"bob\", \"wrongpass\")       # Should fail\n    login_user(\"charlie\", \"password\")   # User doesn't exist\n"